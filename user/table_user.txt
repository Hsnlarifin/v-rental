DROP TABLE license;
DROP TABLE customer;
DROP TABLE staff;
DROP TABLE branch;
DROP TABLE location;
DROP TABLE user;


CREATE TABLE `user` (
  `user_ID` 	  	int(10)		NOT NULL	AUTO_INCREMENT,
  `f_Name`  	  	varchar(255)    NOT NULL,
  `l_Name`  	  	varchar(255)    NOT NULL,
  `gender`  	  	varchar(6)  	NOT NULL,
  `age`     	  	int(3)       	NOT NULL,
  `email`   	  	varchar(60) 	NOT NULL,
  `phoneNo` 	  	varchar(11) 	NOT NULL,
CONSTRAINT USER_PK PRIMARY KEY(user_ID));


CREATE TABLE `location` (
  `location_ID`		int(10) 	NOT NULL	AUTO_INCREMENT,
  `location_Street` 	varchar(100) 	NOT NULL,
  `location_PostCode` 	int(6) 		NOT NULL,
  `location_City` 	varchar(100) 	NOT NULL,
  `location_State` 	varchar(100) 	NOT NULL,
CONSTRAINT LOCATION_PK PRIMARY KEY(location_ID));


CREATE TABLE `branch` (
  `branch_ID`     	int(10)    	NOT NULL	AUTO_INCREMENT,
  `location_ID`   	int(10)    	NOT NULL,
  `branch_Name`   	varchar(255)	NOT NULL,
  `branch_PhoneNo`      varchar(11) 	NOT NULL,
CONSTRAINT BRANCH_PK PRIMARY KEY(branch_ID),
CONSTRAINT BRANCH_LOCATION_FK FOREIGN KEY(location_ID) REFERENCES location(location_ID));


CREATE TABLE `staff` (
  `staff_ID`      	int(10)    	NOT NULL	AUTO_INCREMENT,
  `user_ID`       	int(10)    	NOT NULL,
  `branch_ID`     	int(10)    	NOT NULL,
  `staff_Username`    	varchar(50) 	NOT NULL,
  `staff_Pass`    	varchar(30) 	NOT NULL,
  `staff_Position`    	varchar(100)    NOT NULL,
  `staff_Salary`  	float        	NOT NULL,
CONSTRAINT BRANCH_PK PRIMARY KEY(staff_ID),
CONSTRAINT STAFF_USER_FK FOREIGN KEY(user_ID) REFERENCES user(user_ID),
CONSTRAINT STAFF_BRANCH_FK FOREIGN KEY(branch_ID) REFERENCES Branch (branch_ID));
 

CREATE TABLE `customer` (
  `cust_ID`       	int(10)		NOT NULL	AUTO_INCREMENT,
  `user_ID`       	int(10)		NOT NULL,
  `cust_Username` 	varchar(50) 	NOT NULL,
  `cust_Pass`     	varchar(30) 	NOT NULL,
  `street`        	varchar(100)	NOT NULL,
  `postcode`      	int(6)       	NOT NULL,
  `city`          	varchar(100)    NOT NULL,
  `state`   	  	varchar(100)    NOT NULL,
CONSTRAINT CUST_PK PRIMARY KEY(cust_ID),
CONSTRAINT CUST_USER_FK FOREIGN KEY(user_ID) REFERENCES user(user_ID));


 CREATE TABLE `license` (
  `license_no`		int(10) 	NOT NULL	AUTO_INCREMENT,
 `cust_ID`		int(10)		NOT NULL,
 `license_Type` 	varchar(20) 	NOT NULL,
 `expiration` 		date 		NOT NULL,
CONSTRAINT LICENSE_PK PRIMARY KEY(license_no),
CONSTRAINT LICENSE_CUST_FK FOREIGN KEY(cust_ID) REFERENCES customer(cust_ID));



DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetTotalStaff`(OUT `total` INT(10))
BEGIN
SELECT COUNT(*)
INTO total
FROM staff;
END$$
DELIMITER ;


DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetTotalStaffByBranch`(OUT `branchid` INT(10), OUT `branchname` VARCHAR(255), OUT `total` INT(10))
BEGIN
SELECT b.branch_ID, b.branch_Name, COUNT(s.staff_ID)
INTO branchid, branchname, total
FROM staff s INNER JOIN branch b
ON s.branch_ID = b.branch_ID
GROUP BY b.branch_ID, b.branch_Name
ORDER BY COUNT(s.staff_ID) DESC;
END$$
DELIMITER ;
